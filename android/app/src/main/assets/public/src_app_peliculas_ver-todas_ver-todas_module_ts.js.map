{"version":3,"file":"src_app_peliculas_ver-todas_ver-todas_module_ts.js","mappings":"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","sources":["./src/app/peliculas/ver-todas/ver-todas-routing.module.ts","./src/app/peliculas/ver-todas/ver-todas.module.ts","./src/app/peliculas/ver-todas/ver-todas.page.ts","./src/app/shared/services/notifications.service.ts","./node_modules/@capacitor/local-notifications/dist/esm/definitions.js","./node_modules/@capacitor/local-notifications/dist/esm/index.js","./node_modules/@capacitor/push-notifications/dist/esm/definitions.js","./node_modules/@capacitor/push-notifications/dist/esm/index.js"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { VerTodasPage } from './ver-todas.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: VerTodasPage\r\n  },\r\n  {\r\n    path: 'ver-detalles',\r\n    loadChildren: () => import('./ver-detalles/ver-detalles.module').then( m => m.VerDetallesPageModule)\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class VerTodasPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { VerTodasPageRoutingModule } from './ver-todas-routing.module';\r\n\r\nimport { VerTodasPage } from './ver-todas.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    VerTodasPageRoutingModule,\r\n  ],\r\n  declarations: [VerTodasPage]\r\n})\r\nexport class VerTodasPageModule {\r\n\r\n}\r\n","import { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { Subject } from 'rxjs';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport { Movie } from 'src/app/shared/models/imdbMovies.model';\r\nimport { AuthService } from 'src/app/shared/services/auth.service';\r\nimport { CalendarService } from 'src/app/shared/services/calendar.service';\r\nimport { ImdbService } from 'src/app/shared/services/imdb.service';\r\nimport { NotificationsService } from 'src/app/shared/services/notifications.service';\r\nimport { SeenService } from 'src/app/shared/services/seen.service';\r\nimport * as moment from 'moment';\r\n\r\n@Component({\r\n  selector: 'app-ver-todas',\r\n  templateUrl: './ver-todas.page.html',\r\n  styleUrls: ['./ver-todas.page.scss'],\r\n})\r\nexport class VerTodasPage implements OnInit, OnDestroy {\r\n\r\n  title: number = 0\r\n  loadedMovies: Movie[] = [];\r\n  moviesIds: string[]\r\n  status: boolean = false;\r\n  unsub: Subject<void> = new Subject()\r\n  todayDate: string = moment().format('YYYY-MM-DD')\r\n  constructor (\r\n    private imdbService: ImdbService,\r\n    private notificationsService: NotificationsService,\r\n    private authService: AuthService,\r\n    private router: Router,\r\n    private calendarService: CalendarService\r\n    ) {}\r\n\r\n  ngOnInit() {\r\n  this.imdbService.getMovies()\r\n  .pipe(takeUntil(this.unsub))\r\n  .subscribe(res => {\r\n    for(let key in res){\r\n      this.loadedMovies.push(res[key])\r\n    }\r\n    this.onNotificationCreate()\r\n    this.checkReminder()\r\n  })\r\n  this.status = true;\r\n  this.notificationsService.inicializar()\r\n  }\r\n\r\n  onNotificationCreate() {\r\n    let randomNo: number = Math.floor(Math.random()*this.loadedMovies.length)\r\n    console.log(this.loadedMovies[randomNo].title)\r\n    let notifTitle: string = 'Ya viste la pelicula '\r\n    let notifBody: string = 'Vela ahora mismo que te va a encantar!'\r\n    let randomMovieTitle: string = this.loadedMovies[randomNo].title\r\n    let randomMovieId: string = this.loadedMovies[randomNo].id\r\n    this.notificationsService.createNotification(notifTitle, notifBody, randomMovieTitle )\r\n  }\r\n  \r\n  checkReminder() {\r\n    this.calendarService.onCheckReminder().subscribe(res => {\r\n      console.log('Date retrieved: ' + !!res)\r\n      console.log(new Date().toISOString())\r\n      if (!!res) {\r\n        console.log('Hay reminders')\r\n        console.log(res)\r\n        for (let i in res) {\r\n          let dateToCompare = moment(res[i].date).format('YYYY-MM-DD')\r\n          if (dateToCompare <= this.todayDate) {\r\n            this.imdbService.findMovie(i).subscribe(nextEl => {\r\n              let movie = JSON.parse(JSON.stringify(nextEl))\r\n              console.log('Tienes una alerta para ver ' + movie.title)\r\n              this.notificationsService.createNotification('TenÃ©s un recordatorio', `${movie.title} te espera para ver`, movie.title)\r\n            })\r\n          }\r\n        }\r\n      } else {\r\n        console.log('No hay reminders')\r\n      }\r\n    })\r\n  }\r\n\r\n  onLogout() {\r\n    this.authService.logout();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.unsub.next();\r\n    this.unsub.unsubscribe();\r\n  }\r\n\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  ActionPerformed,\r\n  PushNotificationSchema,\r\n  PushNotifications,\r\n  Token,\r\n} from '@capacitor/push-notifications';\r\n\r\nimport {\r\n  LocalNotifications,\r\n  LocalNotificationsPlugin\r\n} from '@capacitor/local-notifications'\r\nimport { Platform } from '@ionic/angular';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NotificationsService {\r\n\r\n  movieTitle:string = 'They Gray Man'\r\n\r\n\r\n  constructor(public platform: Platform) { }\r\n\r\n  inicializar() {\r\n    if (this.platform.is('capacitor')) {\r\n      PushNotifications.requestPermissions().then(result => {\r\n        console.log('PushNotifications.requestPermission()')\r\n        if (result.receive === 'granted') {\r\n          console.log('Permisos de notificacion Concedidos');\r\n          PushNotifications.register();\r\n          this.addListeners()\r\n        } else {\r\n          // Show some error\r\n        }\r\n      })\r\n\r\n    } else {\r\n      console.log('PushNotifications.requestPermission() -> No es movil')\r\n    }\r\n  }\r\n\r\n  createNotification(title: string, body: string, movieTitle: string) {\r\n    LocalNotifications.schedule({\r\n      notifications: [\r\n        {\r\n          title: title,\r\n          body: body,\r\n          id: 1,\r\n        }\r\n      ]\r\n    })\r\n  }\r\n\r\n  addListeners() {\r\n    // On success, we should be able to receive notifications\r\n    PushNotifications.addListener('registration',\r\n      (token: Token) => {\r\n        console.log('Push registration success, tokend: ' + token.value)\r\n      }\r\n    );\r\n\r\n    // Some issue with our setup and push will not work\r\n    PushNotifications.addListener('registrationError',\r\n      (error: any) => {\r\n        alert('Error on registration: ' + JSON.stringify(error));\r\n      }\r\n    );\r\n\r\n    // PRIMER PLANO\r\n    PushNotifications.addListener('pushNotificationReceived',\r\n      (notification: PushNotificationSchema) => {\r\n        console.log('Notificacion recibida en 1er plano: ' , notification);\r\n      }\r\n    );\r\n\r\n    // Method called when tapping on a notification\r\n    PushNotifications.addListener('pushNotificationActionPerformed',\r\n      (notification: ActionPerformed) => {\r\n        alert('Push action performed: ' + JSON.stringify(notification));\r\n      }\r\n    );\r\n  }\r\n\r\n\r\n  \r\n}\r\n","/// <reference types=\"@capacitor/cli\" />\n/**\n * Day of the week. Used for scheduling notifications on a particular weekday.\n */\nexport var Weekday;\n(function (Weekday) {\n    Weekday[Weekday[\"Sunday\"] = 1] = \"Sunday\";\n    Weekday[Weekday[\"Monday\"] = 2] = \"Monday\";\n    Weekday[Weekday[\"Tuesday\"] = 3] = \"Tuesday\";\n    Weekday[Weekday[\"Wednesday\"] = 4] = \"Wednesday\";\n    Weekday[Weekday[\"Thursday\"] = 5] = \"Thursday\";\n    Weekday[Weekday[\"Friday\"] = 6] = \"Friday\";\n    Weekday[Weekday[\"Saturday\"] = 7] = \"Saturday\";\n})(Weekday || (Weekday = {}));\n","import { registerPlugin } from '@capacitor/core';\nconst LocalNotifications = registerPlugin('LocalNotifications', {\n    web: () => import('./web').then(m => new m.LocalNotificationsWeb()),\n});\nexport * from './definitions';\nexport { LocalNotifications };\n","/// <reference types=\"@capacitor/cli\" />\nexport {};\n","import { registerPlugin } from '@capacitor/core';\nconst PushNotifications = registerPlugin('PushNotifications', {});\nexport * from './definitions';\nexport { PushNotifications };\n"],"names":["Weekday","registerPlugin","LocalNotifications","web","then","m","LocalNotificationsWeb","PushNotifications"],"sourceRoot":"webpack:///","x_google_ignoreList":[4,5,6,7]}